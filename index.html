<!DOCTYPE html>
<html>
<head>
    <title>Test Supabase Simple</title>
</head>
<body>
    <h1>Test Supabase</h1>
    
    <button onclick="test()">Tester Connexion</button>
    <button onclick="creerTables()">Créer Tables</button>
    
    <div id="resultat" style="margin-top: 20px; padding: 10px; border: 1px solid #ccc;"></div>
    
    <script>
        const SUPABASE_URL = 'https://bcwbyugpjlwrpvbbgajg.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_mTp8gGCiA3fd8W83gWSb5w_3OjJMU60';
        
        async function test() {
            document.getElementById('resultat').innerHTML = "Test en cours...";
            
            try {
                // Créer le client
                const { createClient } = window.supabase;
                const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);
                
                // Tester avec une requête simple
                const { data, error } = await supabase
                    .from('controles')
                    .select('*')
                    .limit(1);
                
                if (error) {
                    document.getElementById('resultat').innerHTML = 
                        "ERREUR: " + error.message + "<br><br>" +
                        "Code: " + error.code + "<br>" +
                        "Détails: " + JSON.stringify(error.details) + "<br>" +
                        "Hint: " + error.hint;
                } else {
                    document.getElementById('resultat').innerHTML = 
                        "SUCCÈS! Connecté à Supabase.<br>" +
                        "Données: " + JSON.stringify(data);
                }
            } catch (err) {
                document.getElementById('resultat').innerHTML = 
                    "EXCEPTION: " + err.message + "<br><br>" +
                    "Stack: " + err.stack;
            }
        }
        
        async function creerTables() {
            document.getElementById('resultat').innerHTML = 
                "Pour créer les tables, allez dans Supabase → SQL Editor<br>" +
                "et exécutez ce code :<br><br>" +
                "<pre style='background:#f0f0f0;padding:10px;'>" +
                "CREATE TABLE IF NOT EXISTS controles (\n" +
                "    id TEXT PRIMARY KEY,\n" +
                "    processus TEXT NOT NULL,\n" +
                "    controle TEXT NOT NULL,\n" +
                "    description TEXT,\n" +
                "    responsable TEXT NOT NULL,\n" +
                "    frequence TEXT NOT NULL,\n" +
                "    statut TEXT DEFAULT '❌',\n" +
                "    commentaire TEXT,\n" +
                "    date_verification TEXT\n" +
                ");\n\n" +
                "CREATE TABLE IF NOT EXISTS processus (\n" +
                "    id SERIAL PRIMARY KEY,\n" +
                "    nom TEXT UNIQUE NOT NULL\n" +
                ");\n\n" +
                "-- Désactiver RLS (permissions)\n" +
                "ALTER TABLE controles DISABLE ROW LEVEL SECURITY;\n" +
                "ALTER TABLE processus DISABLE ROW LEVEL SECURITY;</pre>";
        }
        
        // Charger Supabase JS
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2';
        script.onload = function() {
            document.getElementById('resultat').innerHTML = "Supabase JS chargé!";
        };
        document.head.appendChild(script);
    </script>
</body>
</html>
