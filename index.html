<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Grille de Contr√¥le Op√©rationnel</title>
<style>
    * {margin:0;padding:0;box-sizing:border-box;}
    body {font-family:'Segoe UI',sans-serif;background:#f0f2f5;padding:20px;}
    .container {max-width:1200px;margin:0 auto;background:white;border-radius:10px;box-shadow:0 5px 20px rgba(0,0,0,0.1);overflow:hidden;}
    .header {background:#667eea;color:white;padding:20px;text-align:center;position:relative;}
    .header h1 {font-size:24px;margin-bottom:5px;}
    .controls {padding:15px;display:flex;gap:10px;flex-wrap:wrap;}
    .btn {padding:10px 20px;border:none;border-radius:6px;cursor:pointer;font-weight:600;}
    .btn-primary {background:#667eea;color:white;}
    .btn-success {background:#28a745;color:white;}
    .btn-danger {background:#dc3545;color:white;}
    .btn-warning {background:#ffc107;color:#000;}
    .table-container {overflow-x:auto;padding:20px;}
    table {width:100%;border-collapse:collapse;}
    th,td {padding:10px;border:1px solid #ddd;text-align:left;}
    tr:hover {background:#f8f9fa;}
    .status-badge {padding:5px 10px;border-radius:12px;cursor:pointer;font-weight:600;}
    .status-conforme {background:#d4edda;color:#155724;}
    .status-non-conforme {background:#f8d7da;color:#721c24;}
    .modal {display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);justify-content:center;align-items:center;}
    .modal-content {background:white;padding:20px;border-radius:10px;max-width:500px;width:90%;}
    .close {float:right;font-size:24px;cursor:pointer;}
    .form-group {margin-bottom:15px;}
    .form-group input, .form-group select, .form-group textarea {width:100%;padding:8px;border-radius:6px;border:1px solid #ccc;}
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>üìä Grille de Contr√¥le Op√©rationnel</h1>
    </div>

    <div class="controls">
        <button class="btn btn-primary" onclick="openAddProcessModal()">‚ûï Nouveau Processus</button>
        <button class="btn btn-primary" onclick="openAddControlModal()">‚ûï Nouveau Contr√¥le</button>
    </div>

    <div class="table-container">
        <table id="controlTable">
            <thead>
                <tr>
                    <th>Processus / Contr√¥le</th>
                    <th>Description</th>
                    <th>Responsable</th>
                    <th>Fr√©quence</th>
                    <th>Statut</th>
                    <th>Commentaires</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>
</div>

<!-- Modales -->
<div id="addProcessModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeAddProcessModal()">&times;</span>
        <h3>‚ûï Nouveau Processus</h3>
        <div class="form-group">
            <label>Nom du Processus</label>
            <input type="text" id="processNom">
        </div>
        <button class="btn btn-primary" onclick="saveProcess()">Cr√©er</button>
    </div>
</div>

<div id="addControlModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeAddControlModal()">&times;</span>
        <h3>‚ûï Nouveau Contr√¥le</h3>
        <div class="form-group">
            <label>Processus</label>
            <select id="controlProcessus"></select>
        </div>
        <div class="form-group">
            <label>Nom du Contr√¥le</label>
            <input type="text" id="controlNom">
        </div>
        <div class="form-group">
            <label>Description</label>
            <textarea id="controlDescription"></textarea>
        </div>
        <div class="form-group">
            <label>Responsable</label>
            <input type="text" id="controlResponsable">
        </div>
        <div class="form-group">
            <label>Fr√©quence</label>
            <select id="controlFrequence">
                <option>Quotidien</option>
                <option>Hebdomadaire</option>
                <option>Mensuel</option>
                <option>Trimestriel</option>
                <option>Annuel</option>
            </select>
        </div>
        <button class="btn btn-primary" onclick="saveControl()">Enregistrer</button>
    </div>
</div>

<div id="commentModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeCommentModal()">&times;</span>
        <h3>üí¨ Commentaire</h3>
        <textarea id="commentText"></textarea>
        <button class="btn btn-primary" onclick="saveComment()">Enregistrer</button>
    </div>
</div>

<script>
let controles = [];
let processus = [];
let currentCommentId = null;

// Fonctions Modales
function openAddProcessModal(){document.getElementById('addProcessModal').style.display='flex';}
function closeAddProcessModal(){document.getElementById('addProcessModal').style.display='none';}
function openAddControlModal(){
    const sel = document.getElementById('controlProcessus');
    sel.innerHTML='';processus.forEach(p=>{let opt=document.createElement('option');opt.value=p;opt.textContent=p;sel.appendChild(opt);});
    document.getElementById('addControlModal').style.display='flex';
}
function closeAddControlModal(){document.getElementById('addControlModal').style.display='none';}
function openCommentModal(id){currentCommentId=id;document.getElementById('commentText').value=controles.find(c=>c.id===id)?.commentaire||'';document.getElementById('commentModal').style.display='flex';}
function closeCommentModal(){document.getElementById('commentModal').style.display='none';}

// Gestion Processus
function saveProcess(){
    const nom=document.getElementById('processNom').value.trim();
    if(!nom) return alert('Nom requis');
    if(!processus.includes(nom)) processus.push(nom);
    document.getElementById('processNom').value='';
    closeAddProcessModal();
    renderTable();
}

// Gestion Contr√¥le
function saveControl(){
    const proc=document.getElementById('controlProcessus').value;
    const nom=document.getElementById('controlNom').value.trim();
    const desc=document.getElementById('controlDescription').value.trim();
    const resp=document.getElementById('controlResponsable').value.trim();
    const freq=document.getElementById('controlFrequence').value;
    if(!proc||!nom||!resp) return alert('Champs obligatoires');
    const newControl={id:Date.now(),processus:proc,controle:nom,description:desc,responsable:resp,frequence:freq,statut:'‚ùå',commentaire:''};
    controles.push(newControl);
    document.getElementById('controlNom').value='';document.getElementById('controlDescription').value='';document.getElementById('controlResponsable').value='';
    closeAddControlModal();
    renderTable();
}

// Rendu tableau
function renderTable(){
    const tbody=document.getElementById('tableBody');tbody.innerHTML='';
    controles.forEach(ctrl=>{
        const row=document.createElement('tr');
        row.innerHTML=`<td>${ctrl.processus} / ${ctrl.controle}</td>
        <td>${ctrl.description}</td>
        <td>${ctrl.responsable}</td>
        <td>${ctrl.frequence}</td>
        <td><span class="status-badge ${ctrl.statut==='‚úîÔ∏è'?'status-conforme':'status-non-conforme'}" onclick="toggleStatus(${ctrl.id})">${ctrl.statut}</span></td>
        <td><span onclick="openCommentModal(${ctrl.id})" style="cursor:pointer;">üí¨</span> ${ctrl.commentaire}</td>
        <td><button onclick="deleteControl(${ctrl.id})" class="btn btn-danger btn-sm">üóëÔ∏è</button></td>`;
        tbody.appendChild(row);
    });
}

// Actions
function toggleStatus(id){const c=controles.find(c=>c.id===id);if(!c) return;c.statut=c.statut==='‚úîÔ∏è'?'‚ùå':'‚úîÔ∏è';renderTable();}
function deleteControl(id){controles=controles.filter(c=>c.id!==id);renderTable();}
function saveComment(){const c=controles.find(c=>c.id===currentCommentId);if(c){c.commentaire=document.getElementById('commentText').value;}closeCommentModal();renderTable();}
</script>
</body>
</html>
